<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Printbabe - Sales Tracker</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=DotGothic16&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
  import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
  import { getFirestore, collection, addDoc, doc, updateDoc, deleteDoc, onSnapshot, query, where, orderBy, serverTimestamp, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
  import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

  // IMPORTANT: Global variables provided by the Canvas environment
  const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
  const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
  const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

  let db, auth, userId;
  setLogLevel('Debug');

  // --- PIXEL STYLES & CONFIG ---
  tailwind.config = {
    theme: {
      extend: {
        colors: {
          'pixel-lavender': '#E6E6FA', // Light lavender
          'pixel-purple': '#9370DB', // Medium purple
          'pixel-dark': '#4B0082', // Indigo/Dark purple
        },
        fontFamily: {
          'pixel': ['"DotGothic16"', 'sans-serif'],
        },
      }
    }
  };

  // Custom function to create a pixel-art button/card effect
  const pixelBoxShadow = '4px 4px 0 0 rgba(75, 0, 130, 0.8)';

  // Options for Select Dropdowns
  const typeOptions = ['Keychain Long', 'Keychain Rectangle', 'Invitation', 'Print', 'Ref Magnet', 'Others'];
  const paymentOptions = ['Gcash', 'Cash', 'Maya', 'Bank transfer'];

  // --- FIREBASE INITIALIZATION AND AUTH ---
  async function setupFirebase() {
    try {
      if (!firebaseConfig) {
        throw new Error("Firebase configuration is missing.");
      }
      const app = initializeApp(firebaseConfig);
      db = getFirestore(app);
      auth = getAuth(app);

      // Sign in with custom token or anonymously if not available
      if (initialAuthToken) {
        await signInWithCustomToken(auth, initialAuthToken);
      } else {
        await signInAnonymously(auth);
      }

      onAuthStateChanged(auth, (user) => {
        if (user) {
          userId = user.uid;
          console.log("Firebase Auth Ready. User ID:", userId);
          // Start listening for data once authenticated
          startRealtimeListener();
          // Generate initial transaction ID
          generateNextTxnId();
        } else {
          // Fallback for unauthenticated state (should not happen if anon sign-in works)
          userId = crypto.randomUUID();
          console.log("Using anonymous ID:", userId);
        }
      });

    } catch (error) {
      console.error("Error setting up Firebase:", error);
      showMessage("Database Setup Failed. Check console for details.", 'error');
    }
  }

  // --- FIRESTORE DATA FUNCTIONS ---
  const getCollectionRef = () => {
    if (!userId) {
      showMessage("Authentication not ready. Please wait.", 'warning');
      return null;
    }
    // Private data storage path: /artifacts/{appId}/users/{userId}/printbabe_sales
    const collectionPath = `artifacts/${appId}/users/${userId}/printbabe_sales`;
    return collection(db, collectionPath);
  };

  let allOrdersData = []; // To store all orders for invoice/CSV generation
  let latestTxnNumber = 0; // To keep track of the latest transaction number

  function startRealtimeListener() {
    const ordersRef = getCollectionRef();
    if (!ordersRef) return;

    // Sort data by creation date (latest first) to get the highest txnId
    const q = query(ordersRef, orderBy("txnId", "desc")); // Order by txnId to find the latest
    onSnapshot(q, (snapshot) => {
      const orders = [];
      let highestTxnNum = 0;
      snapshot.forEach((doc) => {
        const data = doc.data();
        orders.push({
          id: doc.id,
          txnId: data.txnId || 'N/A',
          amount: data.amount || 0, // TOTAL
          quantity: data.orderCount || 1, // QUANTITY
          orderDate: data.orderDate || '', // NEW DATE
          type: data.type || 'Others', // NEW TYPE
          paymentMethod: data.paymentMethod || 'Cash', // NEW PAYMENT METHOD
          fullName: data.fullName || '', // NEW FULL NAME
          createdAt: data.createdAt ? data.createdAt.toDate().toLocaleDateString('en-PH') : 'N/A'
        });

        // Extract number from txnId (e.g., PB-2024-001 -> 1)
        const match = data.txnId ? data.txnId.match(/(\d+)$/) : null;
        if (match && parseInt(match[1]) > highestTxnNum) {
          highestTxnNum = parseInt(match[1]);
        }
      });
      latestTxnNumber = highestTxnNum; // Update the global latest transaction number
      generateNextTxnId(); // Generate the next one after fetching all data

      allOrdersData = orders; // Update global variable
      renderOrders(orders);
      calculateTotals(orders);
    }, (error) => {
      console.error("Error listening to Firestore:", error);
      showMessage("Error loading data. Check connection.", 'error');
    });
  }

  // Function to generate the next transaction ID
  function generateNextTxnId() {
    const nextNumber = latestTxnNumber + 1;
    const year = new Date().getFullYear();
    const formattedNumber = String(nextNumber).padStart(3, '0');
    document.getElementById('new-txn-id').value = `PB-${year}-${formattedNumber}`;
  }


  // --- UI RENDERING & LOGIC ---
  function calculateTotals(orders) {
    const totalSales = orders.reduce((sum, order) => sum + parseFloat(order.amount || 0), 0);
    const totalQuantity = orders.reduce((sum, order) => sum + parseInt(order.quantity || 1), 0);
    document.getElementById('total-sales').textContent = `₱ ${totalSales.toLocaleString('en-PH', { minimumFractionDigits: 2 })}`;
    document.getElementById('total-orders').textContent = totalQuantity.toLocaleString('en-PH');
    document.getElementById('user-id-display').textContent = `User ID: ${userId}`;
  }

  // Helper to generate SELECT HTML for rendering and editing
  function createSelectHtml(field, id, selectedValue, options) {
    let optionsHtml = options.map(opt => `<option value="${opt}" ${opt === selectedValue ? 'selected' : ''}>${opt}</option>`).join('');
    return `<td class="p-3 border border-pixel-dark" style="box-shadow: 2px 2px 0 0 rgba(75, 0, 130, 0.4);">
              <select data-field="${field}" data-id="${id}" class="w-full bg-transparent outline-none focus:bg-pixel-lavender edit-input p-1" style="background-color: transparent;">
                ${optionsHtml}
              </select>
            </td>`;
  }

  function renderOrders(orders) {
    const list = document.getElementById('orders-list');
    list.innerHTML = ''; // Clear existing list

    if (orders.length === 0) {
      list.innerHTML = `<tr class="bg-pixel-lavender"><td colspan="9" class="py-4 text-center text-pixel-dark border border-pixel-dark" style="box-shadow: ${pixelBoxShadow};">No orders recorded yet! Add one above.</td></tr>`;
      return;
    }

    orders.forEach((order, index) => {
      const row = document.createElement('tr');
      row.className = `bg-white hover:bg-pixel-lavender transition-colors`;
      row.innerHTML = `
        <td class="p-3 border border-pixel-dark text-center" style="box-shadow: 2px 2px 0 0 rgba(75, 0, 130, 0.4);">
          <input type="checkbox" data-id="${order.id}" class="select-checkbox form-checkbox h-5 w-5 text-pixel-purple border-pixel-dark rounded cursor-pointer">
        </td>
        <td class="p-3 border border-pixel-dark" style="box-shadow: 2px 2px 0 0 rgba(75, 0, 130, 0.4);">
          <input type="date" data-field="orderDate" data-id="${order.id}" value="${order.orderDate}" class="w-full bg-transparent outline-none focus:bg-pixel-lavender edit-input" placeholder="Date">
        </td>
        <td class="p-3 border border-pixel-dark" style="box-shadow: 2px 2px 0 0 rgba(75, 0, 130, 0.4);">
          <input type="text" data-field="fullName" data-id="${order.id}" value="${order.fullName}" class="w-full bg-transparent outline-none focus:bg-pixel-lavender edit-input" placeholder="Client Name">
        </td>
        <td class="p-3 border border-pixel-dark" style="box-shadow: 2px 2px 0 0 rgba(75, 0, 130, 0.4);">
          <input type="number" data-field="orderCount" data-id="${order.id}" value="${order.quantity}" class="w-full bg-transparent outline-none focus:bg-pixel-lavender edit-input text-center" min="1">
        </td>
        ${createSelectHtml('type', order.id, order.type, typeOptions)}
        ${createSelectHtml('paymentMethod', order.id, order.paymentMethod, paymentOptions)}
        <td class="p-3 border border-pixel-dark" style="box-shadow: 2px 2px 0 0 rgba(75, 0, 130, 0.4);">
          <input type="text" data-field="txnId" data-id="${order.id}" value="${order.txnId}" class="w-full bg-transparent outline-none focus:bg-pixel-lavender edit-input" placeholder="Transaction Number">
        </td>
        <td class="p-3 border border-pixel-dark" style="box-shadow: 2px 2px 0 0 rgba(75, 0, 130, 0.4);">
          <input type="number" data-field="amount" data-id="${order.id}" value="${order.amount}" class="w-full bg-transparent outline-none focus:bg-pixel-lavender edit-input text-right" placeholder="0.00">
        </td>
        <td class="p-3 border border-pixel-dark text-center flex flex-col space-y-1 items-center justify-center" style="box-shadow: 2px 2px 0 0 rgba(75, 0, 130, 0.4);">
          <button onclick="window.downloadInvoice('${order.id}')" class="text-xs font-bold bg-blue-500 text-white px-2 py-1 rounded-sm shadow-md hover:bg-blue-600 transition-colors" style="box-shadow: 2px 2px 0 0 #2563eb;"> INVOICE </button>
          <button onclick="window.deleteOrder('${order.id}')" class="text-xs font-bold bg-red-500 text-white px-2 py-1 rounded-sm shadow-md hover:bg-red-600 transition-colors" style="box-shadow: 2px 2px 0 0 #b91c1c;"> DELETE </button>
        </td>
      `;
      list.appendChild(row);
    });

    // Add event listeners for direct editing
    document.querySelectorAll('.edit-input').forEach(input => {
      input.addEventListener('change', handleEditChange);
    });

    // Add event listener for "Select All" functionality
    document.getElementById('select-all').addEventListener('change', toggleSelectAll);
  }

  function toggleSelectAll(event) {
    const isChecked = event.target.checked;
    document.querySelectorAll('.select-checkbox').forEach(checkbox => {
      checkbox.checked = isChecked;
    });
  }

  // --- DATABASE MUTATIONS (Submit, Edit, Delete) ---
  async function submitNewOrder() {
    // New Fields
    const date = document.getElementById('new-order-date').value.trim();
    const quantity = parseInt(document.getElementById('new-quantity').value);
    const fullName = document.getElementById('new-full-name').value.trim(); // NEW
    const type = document.getElementById('new-type').value;
    const paymentMethod = document.getElementById('new-payment-method').value;
    // Existing/Total Fields
    const txnId = document.getElementById('new-txn-id').value.trim();
    const amount = parseFloat(document.getElementById('new-amount').value);

    if (!date || !txnId || isNaN(amount) || amount <= 0 || isNaN(quantity) || quantity < 1 || !fullName) { // Added fullName validation
      showMessage("Please fill in Date, Full Name, Txn #, Quantity, and Total Amount (₱).", 'warning');
      return;
    }

    const ordersRef = getCollectionRef();
    if (!ordersRef) return;

    try {
      await addDoc(ordersRef, {
        txnId: txnId,
        amount: amount,
        orderCount: quantity, // Stored as orderCount in DB for simplicity
        orderDate: date,
        type: type,
        paymentMethod: paymentMethod,
        fullName: fullName, // NEW
        createdAt: serverTimestamp(),
        userId: userId,
      });
      showMessage("Order added successfully!", 'success');
      // Clear form but keep today's date selected for convenience
      document.getElementById('order-form').reset();
      document.getElementById('new-order-date').value = date;
      generateNextTxnId(); // Generate the next transaction ID for the new form
    } catch (e) {
      console.error("Error adding document: ", e);
      showMessage("Failed to add order.", 'error');
    }
  }

  async function handleEditChange(event) {
    const input = event.target;
    const docId = input.getAttribute('data-id');
    const field = input.getAttribute('data-field');
    let value = input.value;

    // Type conversion and validation for numerical fields
    if (field === 'amount') {
      value = parseFloat(value);
      if (isNaN(value) || value < 0) {
        showMessage("Invalid amount value.", 'warning');
        return;
      }
    } else if (field === 'orderCount') {
      value = parseInt(value);
      if (isNaN(value) || value < 1) {
        showMessage("Invalid quantity.", 'warning');
        return;
      }
    }

    const ordersRef = getCollectionRef();
    if (!ordersRef) return;

    try {
      const docRef = doc(ordersRef, docId);
      await updateDoc(docRef, {
        [field]: value
      });
      // Note: No success message to avoid spamming user on every field change
    } catch (e) {
      console.error("Error updating document: ", e);
      showMessage("Failed to update order.", 'error');
    }
  }

  window.deleteOrder = async function(docId) {
    if (!confirm("Are you sure you want to delete this order?")) return;
    const ordersRef = getCollectionRef();
    if (!ordersRef) return;

    try {
      const docRef = doc(ordersRef, docId);
      await deleteDoc(docRef);
      showMessage("Order deleted successfully!", 'success');
    } catch (e) {
      console.error("Error deleting document: ", e);
      showMessage("Failed to delete order.", 'error');
    }
  }

  // --- INVOICE & CSV GENERATION ---
  // Download a single PDF invoice
  window.downloadInvoice = function(orderId) {
    const order = allOrdersData.find(o => o.id === orderId);
    if (!order) {
      showMessage("Order not found for invoice generation.", 'error');
      return;
    }

    const {
      jsPDF
    } = window.jspdf;
    const doc = new jsPDF();
    let yPos = 20;

    doc.setFontSize(22);
    doc.text("INVOICE - Photo and Printbabe", 105, yPos, null, null, "center");
    yPos += 10;
    doc.setFontSize(10);
    doc.text("Date Generated: " + new Date().toLocaleDateString('en-PH'), 105, yPos, null, null, "center");
    yPos += 20;

    doc.setFontSize(12);
    doc.text(`Invoice # : ${order.txnId}`, 20, yPos);
    yPos += 7;
    doc.text(`Order Date : ${order.orderDate}`, 20, yPos);
    yPos += 7;
    doc.text(`Client Name : ${order.fullName}`, 20, yPos); // NEW
    yPos += 7;
    doc.text(`Payment Via : ${order.paymentMethod}`, 20, yPos);
    yPos += 15;

    // Table Header
    doc.setFontSize(12);
    doc.text("Item Description", 20, yPos);
    doc.text("Qty", 120, yPos);
    doc.text("Unit Price", 140, yPos);
    doc.text("Total", 180, yPos);
    yPos += 5;
    doc.setLineWidth(0.5);
    doc.line(20, yPos, 190, yPos); // Horizontal line
    yPos += 10;

    // Table Row
    doc.text(order.type, 20, yPos);
    doc.text(order.quantity.toString(), 120, yPos);
    const unitPrice = order.amount / order.quantity;
    doc.text(`₱ ${unitPrice.toLocaleString('en-PH', { minimumFractionDigits: 2 })}`, 140, yPos);
    doc.text(`₱ ${order.amount.toLocaleString('en-PH', { minimumFractionDigits: 2 })}`, 180, yPos);
    yPos += 10;

    doc.setLineWidth(0.2);
    doc.line(20, yPos, 190, yPos); // Horizontal line
    yPos += 10;

    // Total
    doc.setFontSize(14);
    doc.text("GRAND TOTAL:", 140, yPos);
    doc.text(`₱ ${order.amount.toLocaleString('en-PH', { minimumFractionDigits: 2 })}`, 180, yPos);
    yPos += 20;

    doc.setFontSize(10);
    doc.text("Thank you for your business!", 105, yPos, null, null, "center");
    doc.save(`Invoice_${order.txnId}.pdf`);
    showMessage(`Invoice for ${order.txnId} downloaded!`, 'success');
  };

  // NEW: Download all data as a CSV file
  window.downloadAllAsCSV = function() {
    if (allOrdersData.length === 0) {
      showMessage("No data to download.", 'warning');
      return;
    }

    const headers = ['Transaction ID', 'Order Date', 'Full Name', 'Type', 'Quantity', 'Payment Method', 'Total Amount (PHP)']; // Added Full Name
    const csvRows = [headers.join(',')]; // Header row

    // Get data rows, ensuring values with commas are wrapped in quotes
    allOrdersData.forEach(order => {
      const values = [
        `"${order.txnId.replace(/"/g, '""')}"`, // Handle quotes
        `"${order.orderDate}"`,
        `"${order.fullName.replace(/"/g, '""')}"`, // NEW
        `"${order.type.replace(/"/g, '""')}"`,
        order.quantity,
        `"${order.paymentMethod}"`,
        order.amount
      ];
      csvRows.push(values.join(','));
    });

    const csvContent = csvRows.join('\n');
    const blob = new Blob([csvContent], {
      type: 'text/csv;charset=utf-8;'
    });
    const link = document.createElement('a');

    if (link.download !== undefined) { // Feature detection
      const url = URL.createObjectURL(blob);
      link.setAttribute('href', url);
      link.setAttribute('download', 'Printbabe_Sales_Data.csv');
      link.style.visibility = 'hidden';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      showMessage("Sales data downloaded as CSV!", 'success');
    } else {
      showMessage("CSV download not supported in this browser.", 'error');
    }
  }

  // --- UTILITY & MESSAGING ---
  function showMessage(message, type) {
    const msgBox = document.getElementById('message-box');
    msgBox.textContent = message;
    // Apply style based on type
    msgBox.className = 'p-3 mb-4 rounded-sm font-bold text-sm text-white transition-all duration-300 ' + (type === 'success' ? 'bg-green-600' : type === 'warning' ? 'bg-yellow-500' : 'bg-red-600');
    msgBox.style.opacity = '1';
    setTimeout(() => {
      msgBox.style.opacity = '0';
    }, 3000);
  }

  // Expose function to window for the HTML button
  window.submitNewOrder = submitNewOrder;

  // Set default date to today for convenience
  document.addEventListener('DOMContentLoaded', () => {
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('new-order-date').value = today;
  });

  // Start the application setup
  window.onload = setupFirebase;
</script>
<style>
  .pixel-shadow {
    box-shadow: 4px 4px 0 0 #4B0082;
    /* Custom pixel-art shadow */
    border: 2px solid #4B0082;
    /* Dark purple border */
  }

  .pixel-btn {
    box-shadow: 3px 3px 0 0 #4B0082;
    transition: all 0.1s ease;
  }

  .pixel-btn:active {
    box-shadow: 1px 1px 0 0 #4B0082;
    transform: translate(2px, 2px);
  }

  .edit-input {
    /* Ensures date and select inputs look consistent */
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
  }
</style>
</head>
<body class="bg-pixel-lavender min-h-screen p-4 md:p-8 font-pixel text-pixel-dark">
<div id="message-box" class="fixed top-0 left-1/2 -translate-x-1/2 mt-4 z-50 opacity-0" style="min-width: 300px;"></div>
<div class="max-w-6xl mx-auto">
  <header class="text-center mb-8 pixel-shadow bg-pixel-purple text-white p-4 rounded-lg flex flex-col items-center justify-center">
    <img src="1.jpg" alt="Printbabe Logo" class="h-20 w-20 md:h-24 md:w-24 object-contain mb-2">
    <h1 class="text-3xl md:text-5xl tracking-widest">PHOTO & PRINTBABE</h1>
    <p class="text-sm mt-2">Sales and Order Management System - PH Peso</p>
    <p id="user-id-display" class="text-xs mt-1 opacity-75"></p>
  </header>

  <section class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
    <div class="pixel-shadow bg-white p-6 rounded-lg">
      <p class="text-lg font-bold">TOTAL SALES (PHP)</p>
      <p id="total-sales" class="text-5xl mt-2 text-pixel-purple">₱ 0.00</p>
    </div>
    <div class="pixel-shadow bg-white p-6 rounded-lg">
      <p class="text-lg font-bold">TOTAL ITEMS SOLD</p>
      <p id="total-orders" class="text-5xl mt-2 text-pixel-purple">0</p>
    </div>
  </section>

  <section class="mb-8 p-6 pixel-shadow bg-white rounded-lg">
    <h2 class="text-2xl font-bold mb-4">ADD NEW ORDER / INVOICE</h2>
    <form id="order-form" class="grid grid-cols-1 md:grid-cols-6 gap-4 items-end">
      <div class="col-span-1 md:col-span-1">
        <label for="new-order-date" class="block text-sm font-medium mb-1">DATE</label>
        <input type="date" id="new-order-date" class="w-full p-2 border-2 border-pixel-dark rounded-sm bg-pixel-lavender focus:bg-white focus:outline-pixel-purple" required style="box-shadow: 2px 2px 0 0 rgba(75, 0, 130, 0.4);">
      </div>
      <div>
        <label for="new-quantity" class="block text-sm font-medium mb-1">QUANTITY</label>
        <input type="number" id="new-quantity" placeholder="1" value="1" min="1" class="w-full p-2 border-2 border-pixel-dark rounded-sm bg-pixel-lavender focus:bg-white focus:outline-pixel-purple text-center" required style="box-shadow: 2px 2px 0 0 rgba(75, 0, 130, 0.4);">
      </div>
      <div class="col-span-1 md:col-span-2">
        <label for="new-full-name" class="block text-sm font-medium mb-1">FULL NAME</label>
        <input type="text" id="new-full-name" placeholder="Client's Full Name" class="w-full p-2 border-2 border-pixel-dark rounded-sm bg-pixel-lavender focus:bg-white focus:outline-pixel-purple" required style="box-shadow: 2px 2px 0 0 rgba(75, 0, 130, 0.4);">
      </div>
      <div class="col-span-1 md:col-span-2">
        <label for="new-type" class="block text-sm font-medium mb-1">TYPE</label>
        <select id="new-type" class="w-full p-2 border-2 border-pixel-dark rounded-sm bg-pixel-lavender focus:bg-white focus:outline-pixel-purple" style="box-shadow: 2px 2px 0 0 rgba(75, 0, 130, 0.4);">
          <option value="Keychain Long">Keychain Long</option>
          <option value="Keychain Rectangle">Keychain Rectangle</option>
          <option value="Invitation">Invitation</option>
          <option value="Print">Print</option>
          <option value="Ref Magnet">Ref Magnet</option>
          <option value="Others" selected>Others</option>
        </select>
      </div>

      <div class="col-span-1 md:col-span-2">
        <label for="new-txn-id" class="block text-sm font-medium mb-1">Transaction/Invoice Number</label>
        <input type="text" id="new-txn-id" placeholder="e.g., PB-2024-001" class="w-full p-2 border-2 border-pixel-dark rounded-sm bg-pixel-lavender focus:bg-white focus:outline-pixel-purple" required readonly style="box-shadow: 2px 2px 0 0 rgba(75, 0, 130, 0.4);">
      </div>
      <div class="col-span-1 md:col-span-2">
        <label for="new-payment-method" class="block text-sm font-medium mb-1">PAYMENT METHOD</label>
        <select id="new-payment-method" class="w-full p-2 border-2 border-pixel-dark rounded-sm bg-pixel-lavender focus:bg-white focus:outline-pixel-purple" style="box-shadow: 2px 2px 0 0 rgba(75, 0, 130, 0.4);">
          <option value="Gcash">Gcash</option>
          <option value="Cash" selected>Cash</option>
          <option value="Maya">Maya</option>
          <option value="Bank transfer">Bank transfer</option>
        </select>
      </div>
      <div>
        <label for="new-amount" class="block text-sm font-medium mb-1">TOTAL (₱)</label>
        <input type="number" id="new-amount" placeholder="500.00" min="0.01" step="0.01" class="w-full p-2 border-2 border-pixel-dark rounded-sm bg-pixel-lavender focus:bg-white focus:outline-pixel-purple text-right" required style="box-shadow: 2px 2px 0 0 rgba(75, 0, 130, 0.4);">
      </div>
      <button type="button" onclick="submitNewOrder()" class="col-span-1 md:col-span-1 w-full px-6 py-2 bg-pixel-purple text-white font-bold rounded-sm hover:bg-violet-700 transition-colors pixel-btn"> SAVE </button>
    </form>
  </section>

  <section class="p-4 md:p-6 pixel-shadow bg-white rounded-lg overflow-x-auto">
    <div class="flex flex-col md:flex-row justify-between items-center mb-4">
      <h2 class="text-2xl font-bold mb-2 md:mb-0">ALL INVOICES</h2>
      <div class="flex items-center space-x-4">
        <label class="flex items-center space-x-2 text-sm font-bold">
          <input type="checkbox" id="select-all" class="form-checkbox h-4 w-4 text-pixel-purple border-pixel-dark rounded cursor-pointer">
          <span>Select All</span>
        </label>
        <button onclick="window.downloadAllAsCSV()" class="px-3 py-1 text-sm bg-green-600 text-white font-bold rounded-sm hover:bg-green-700 transition-colors pixel-btn" style="box-shadow: 3px 3px 0 0 #15803d;"> DOWNLOAD ALL (CSV) </button>
      </div>
    </div>
    <table class="min-w-full border-collapse border border-pixel-dark text-sm">
      <thead>
      <tr class="bg-pixel-purple text-white">
        <th class="p-3 border border-pixel-dark w-10">SEL.</th>
        <th class="p-3 border border-pixel-dark text-left">DATE (Edit)</th>
        <th class="p-3 border border-pixel-dark text-left">FULL NAME (Edit)</th> <th class="p-3 border border-pixel-dark text-center">QTY (Edit)</th>
        <th class="p-3 border border-pixel-dark text-left">TYPE (Edit)</th>
        <th class="p-3 border border-pixel-dark text-left">PAYMENT (Edit)</th>
        <th class="p-3 border border-pixel-dark text-left">INVOICE/TXN # (Edit)</th>
        <th class="p-3 border border-pixel-dark text-right">TOTAL (₱) (Edit)</th>
        <th class="p-3 border border-pixel-dark w-24">ACTIONS</th>
      </tr>
      </thead>
      <tbody id="orders-list">
      </tbody>
    </table>
    <p class="mt-4 text-sm text-gray-500">Note: All fields in the table are editable and saved instantly.</p>
  </section>
</div>
</body>
</html>
