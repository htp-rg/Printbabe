<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Calorie Tracker â€” Printbabe Style</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
  :root{
    --lav: #E6E6FA;
    --pur: #9370DB;
    --dark: #4B0082;
  }
  body {
    font-family: "Inter", system-ui;
    background: var(--lav);
    color: var(--dark);
  }
  .pixel-shadow { box-shadow: 4px 4px 0 0 var(--dark); border:2px solid var(--dark); }
  .pixel-btn { box-shadow: 3px 3px 0 0 var(--dark); transition: all .1s; }
  .pixel-btn:active { box-shadow: 1px 1px 0 0 var(--dark); transform: translate(2px,2px); }
  .small { font-size:0.85rem }
  tbody tr:nth-child(odd) { background: #fff; }
  tbody tr:nth-child(even) { background: #f9f8ff; }
</style>
</head>
<body class="min-h-screen p-6">
<div class="max-w-6xl mx-auto">

  <!-- HEADER -->
  <header class="text-center mb-6 pixel-shadow bg-[color:var(--pur)] text-white p-4 rounded-lg">
    <h1 class="text-3xl font-bold tracking-widest">Calorie Tracker</h1>
    <p class="text-sm mt-1">Track calories, nutrients & goals â€” Printbabe style ðŸ’œ</p>
    <div id="profile-summary" class="mt-3 text-sm"></div>
  </header>

  <main class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- PROFILE -->
    <section class="pixel-shadow bg-white p-4 rounded-lg">
      <h2 class="text-lg font-bold mb-2">Profile & Daily Target</h2>
      <form id="profile-form" class="space-y-3">
        <div>
          <label class="block small mb-1">Gender</label>
          <select id="gender" class="w-full p-2 border-2 border-[color:var(--dark)] rounded-sm bg-[color:var(--lav)]">
            <option value="male">Male</option>
            <option value="female">Female</option>
          </select>
        </div>

        <div class="grid grid-cols-3 gap-2">
          <div><label class="block small mb-1">Age</label><input id="age" type="number" min="4" class="w-full p-2 border-2 border-[color:var(--dark)] rounded-sm" /></div>
          <div><label class="block small mb-1">Height (cm)</label><input id="height" type="number" min="50" class="w-full p-2 border-2 border-[color:var(--dark)] rounded-sm" /></div>
          <div><label class="block small mb-1">Weight (kg)</label><input id="weight" type="number" min="10" step="0.1" class="w-full p-2 border-2 border-[color:var(--dark)] rounded-sm" /></div>
        </div>

        <div>
          <label class="block small mb-1">Activity</label>
          <select id="activity" class="w-full p-2 border-2 border-[color:var(--dark)] rounded-sm bg-[color:var(--lav)]">
            <option value="1.2">Sedentary</option>
            <option value="1.375">Lightly active</option>
            <option value="1.55">Moderately active</option>
            <option value="1.725">Very active</option>
            <option value="1.9">Extra active</option>
          </select>
        </div>

        <div class="flex gap-2">
          <button type="button" id="calc-target" class="w-full pixel-btn bg-[color:var(--pur)] text-white p-2 rounded">Save & Calculate</button>
          <button type="button" id="clear-profile" class="w-full pixel-btn bg-gray-300 text-black p-2 rounded">Clear</button>
        </div>

        <div class="mt-3 bg-[color:var(--lav)] border-2 border-[color:var(--dark)] p-3 rounded">
          <p class="small">BMR: <strong id="bmr">â€”</strong></p>
          <p class="small">Target: <strong id="daily-target" class="text-[color:var(--dark)] text-lg">â€”</strong></p>
        </div>
      </form>
    </section>

    <!-- ADD / SEARCH MEAL -->
    <section class="col-span-2 pixel-shadow bg-white p-4 rounded-lg">
      <h2 class="text-lg font-bold mb-2">Add Meal / Search Food</h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-2 mb-3">
        <input id="meal-date" type="date" class="p-2 border-2 border-[color:var(--dark)] rounded-sm" />
        <input id="meal-name" placeholder="Food name (e.g., banana)" class="p-2 border-2 border-[color:var(--dark)] rounded-sm" />
        <select id="serving-type" class="p-2 border-2 border-[color:var(--dark)] rounded-sm bg-[color:var(--lav)]">
          <option value="100">Per 100g</option>
          <option value="portion">Per Portion</option>
        </select>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-5 gap-2 mb-2">
        <input id="grams" type="number" min="1" placeholder="grams" class="p-2 border-2 border-[color:var(--dark)] rounded-sm" />
        <input id="calories" type="number" min="0" placeholder="Calories" class="p-2 border-2 border-[color:var(--dark)] rounded-sm" />
        <input id="carbs" type="number" min="0" placeholder="Carbs (g)" class="p-2 border-2 border-[color:var(--dark)] rounded-sm" />
        <input id="protein" type="number" min="0" placeholder="Protein (g)" class="p-2 border-2 border-[color:var(--dark)] rounded-sm" />
        <input id="fat" type="number" min="0" placeholder="Fat (g)" class="p-2 border-2 border-[color:var(--dark)] rounded-sm" />
      </div>

      <div class="flex gap-2 mb-2">
        <button id="search-food" class="pixel-btn bg-[color:var(--pur)] text-white p-2 rounded">Search Food</button>
        <button id="add-meal" class="pixel-btn bg-[color:var(--dark)] text-white p-2 rounded">Add Meal</button>
        <button id="reset-form" class="pixel-btn bg-gray-300 text-black p-2 rounded">Reset</button>
      </div>

      <p class="small text-gray-600">Use short keywords. Results auto-fill nutrients if found.</p>
    </section>

    <!-- MEAL LIST -->
    <section class="col-span-3 pixel-shadow bg-white p-4 rounded-lg">
      <div class="flex justify-between items-center mb-3">
        <h2 class="text-lg font-bold">Meal Log</h2>
        <button id="clear-all" class="pixel-btn bg-red-500 text-white px-3 py-1 rounded">Clear All</button>
      </div>
      <div class="overflow-x-auto">
        <table class="min-w-full border-collapse text-sm">
          <thead>
            <tr class="bg-[color:var(--pur)] text-white">
              <th class="p-2 border">Date</th>
              <th class="p-2 border">Food</th>
              <th class="p-2 border">kcal</th>
              <th class="p-2 border">Carbs</th>
              <th class="p-2 border">Protein</th>
              <th class="p-2 border">Fat</th>
            </tr>
          </thead>
          <tbody id="meals-tbody"></tbody>
        </table>
      </div>
      <div class="mt-4 bg-[color:var(--lav)] p-3 rounded border">
        <p><strong>Todayâ€™s total:</strong> <span id="today-cals">0</span> kcal</p>
      </div>
      <canvas id="cal-chart" class="mt-4"></canvas>
    </section>
  </main>
</div>

<script>
const PROFILE_KEY = 'ct_profile';
const MEALS_KEY = 'ct_meals';

const gender = document.getElementById('gender');
const age = document.getElementById('age');
const height = document.getElementById('height');
const weight = document.getElementById('weight');
const activity = document.getElementById('activity');
const bmrEl = document.getElementById('bmr');
const dailyTargetEl = document.getElementById('daily-target');
const profileSummary = document.getElementById('profile-summary');

const mealDate = document.getElementById('meal-date');
const mealName = document.getElementById('meal-name');
const grams = document.getElementById('grams');
const calories = document.getElementById('calories');
const carbs = document.getElementById('carbs');
const protein = document.getElementById('protein');
const fat = document.getElementById('fat');
const mealsTbody = document.getElementById('meals-tbody');
const todayCals = document.getElementById('today-cals');

const calcBtn = document.getElementById('calc-target');
const clearProfile = document.getElementById('clear-profile');
const addMealBtn = document.getElementById('add-meal');
const searchFoodBtn = document.getElementById('search-food');
const resetFormBtn = document.getElementById('reset-form');
const clearAllBtn = document.getElementById('clear-all');

let profile = JSON.parse(localStorage.getItem(PROFILE_KEY) || 'null');
let meals = JSON.parse(localStorage.getItem(MEALS_KEY) || '[]');

function saveProfile(p){ localStorage.setItem(PROFILE_KEY, JSON.stringify(p)); }
function saveMeals(m){ localStorage.setItem(MEALS_KEY, JSON.stringify(m)); }

function calcBMR(w,h,a,g){ return g==='male' ? 10*w+6.25*h-5*a+5 : 10*w+6.25*h-5*a-161; }

function updateProfileDisplay(){
  if(!profile){ bmrEl.textContent='â€”'; dailyTargetEl.textContent='â€”'; profileSummary.textContent=''; return; }
  const bmr = calcBMR(profile.weight,profile.height,profile.age,profile.gender);
  const daily = Math.round(bmr * parseFloat(profile.activity));
  bmrEl.textContent = `${Math.round(bmr)} kcal`;
  dailyTargetEl.textContent = `${daily} kcal`;
  profileSummary.innerHTML = `<b>${profile.gender}</b>, ${profile.age} yrs, ${profile.height}cm / ${profile.weight}kg â€” <b>${daily} kcal/day</b>`;
}

calcBtn.onclick = ()=>{
  profile = { gender: gender.value, age:+age.value, height:+height.value, weight:+weight.value, activity:activity.value };
  saveProfile(profile);
  updateProfileDisplay();
  alert('Profile saved!');
};

clearProfile.onclick = ()=>{
  localStorage.removeItem(PROFILE_KEY);
  profile=null; updateProfileDisplay();
};

mealDate.value = new Date().toISOString().slice(0,10);

addMealBtn.onclick = ()=>{
  if(!mealName.value){ alert('Enter food name'); return; }
  meals.push({ date: mealDate.value, name: mealName.value, calories:+calories.value, carbs:+carbs.value, protein:+protein.value, fat:+fat.value });
  saveMeals(meals);
  renderMeals();
};

searchFoodBtn.onclick = async()=>{
  if(!mealName.value) return alert('Enter food name to search');
  searchFoodBtn.textContent='Searching...';
  const res = await fetch(`https://world.openfoodfacts.org/cgi/search.pl?search_terms=${mealName.value}&json=1&page_size=1`);
  const data = await res.json();
  const p = data.products?.[0]?.nutriments;
  if(p){
    calories.value = p['energy-kcal_100g'] || 0;
    carbs.value = p['carbohydrates_100g'] || 0;
    protein.value = p['proteins_100g'] || 0;
    fat.value = p['fat_100g'] || 0;
    alert('Auto-filled from OpenFoodFacts');
  } else alert('No data found');
  searchFoodBtn.textContent='Search Food';
};

function renderMeals(){
  mealsTbody.innerHTML = meals.map(m=>`
    <tr>
      <td class="border p-1">${m.date}</td>
      <td class="border p-1">${m.name}</td>
      <td class="border p-1">${m.calories}</td>
      <td class="border p-1">${m.carbs}</td>
      <td class="border p-1">${m.protein}</td>
      <td class="border p-1">${m.fat}</td>
    </tr>`).join('') || `<tr><td colspan="6" class="text-center p-2 text-gray-500">No meals yet</td></tr>`;
  updateTotals();
}

function updateTotals(){
  const today = new Date().toISOString().slice(0,10);
  const todayMeals = meals.filter(m=>m.date===today);
  const total = todayMeals.reduce((s,m)=>s+(+m.calories||0),0);
  todayCals.textContent = total.toFixed(1);
}

clearAllBtn.onclick=()=>{
  if(confirm('Delete all meals?')){ meals=[]; saveMeals(meals); renderMeals(); }
};

resetFormBtn.onclick=()=>[mealName,grams,calories,carbs,protein,fat].forEach(i=>i.value='');

updateProfileDisplay();
renderMeals();
</script>
</body>
</html>
